<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Expense Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
    <header class="header">
      <h1 class="title">EXPENSE TRACKER</h1>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation"></button>
      <nav class="app-nav" aria-label="App navigation">
      <a href="index.html">Planner</a>
      <a href="habit-builder.html">Habits</a>
      <a href="expense-tracker.html" class="active">Expenses</a>
      <a href="pomodoro.html">Pomodoro</a>
      <a href="work.html">Work</a>
      <div class="nav-controls">
        <button type="button" id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light mode">
          <span class="theme-icon">🌙</span>
          <span class="theme-text">Dark Mode</span>
        </button>
        <div class="auth-section">
          <div id="auth-status" class="auth-status">
            <span id="user-email" class="user-email"></span>
            <button type="button" id="sign-out-btn" class="sign-out-btn" style="display: none;">Sign Out</button>
            
            <!-- User Info Dropdown -->
            <div id="user-info-dropdown" class="user-info-dropdown" style="display: none;">
                <div class="user-info-header">
                    <h3>Account Information</h3>
                </div>
                <div class="user-info-content">
                    <div class="info-row">
                        <label>Email:</label>
                        <span id="dropdown-email">Loading...</span>
                    </div>
                    <div class="info-row">
                        <label>Display Name:</label>
                        <input type="text" id="dropdown-display-name" class="dropdown-input" placeholder="Enter name">
                    </div>
                    <div class="info-row">
                        <label>Account Created:</label>
                        <span id="dropdown-created">Loading...</span>
                    </div>
                    <div class="info-row">
                        <label>Last Login:</label>
                        <span id="dropdown-last-login">Loading...</span>
                    </div>
                    <div class="info-row">
                        <label>Provider:</label>
                        <span id="dropdown-provider">Loading...</span>
                    </div>
                </div>
                <div class="user-info-actions">
                    <button type="button" id="save-user-info-btn" class="save-user-info-btn">Save Changes</button>
                    <button type="button" id="dropdown-logout-btn" class="dropdown-logout-btn">Log Out</button>
                    <button type="button" id="delete-account-btn" class="delete-account-btn">Delete Account</button>
                </div>
            </div>
          </div>
          <button type="button" id="sign-in-btn" class="sign-in-btn" style="display: none;">Sign In</button>
        </div>
      </div>
    </nav>
    </header>

    <section class="calendar-section">
      <div class="calendar-top">
        <div class="date-controls">
          <div class="date-input-row">
            <label for="date-picker" class="sr-only">Select date</label>
            <input type="date" id="date-picker" class="date-picker" aria-label="Select date">
          </div>
        </div>
      </div>

      <div class="calendar-bottom">
        <div class="weekday-toggles" role="group" aria-label="Weekday selection">
          <button type="button" class="weekday-btn" data-day="1">M</button>
          <button type="button" class="weekday-btn" data-day="2">T</button>
          <button type="button" class="weekday-btn" data-day="3">W</button>
          <button type="button" class="weekday-btn" data-day="4">T</button>
          <button type="button" class="weekday-btn" data-day="5">F</button>
          <button type="button" class="weekday-btn" data-day="6">S</button>
          <button type="button" class="weekday-btn" data-day="0">S</button>
        </div>
      </div>
    </section>
    <script>
      (function(){
        const header = document.querySelector('.header');
        const btn = document.getElementById('nav-toggle');
        const nav = document.querySelector('.app-nav');
        const root = document.documentElement;
        if(!btn || !header) return;
        btn.setAttribute('aria-expanded','false');
        btn.addEventListener('click', ()=>{
          // toggle both header-local and a global root class as a fallback
          const openLocal = header.classList.toggle('nav-open');
          const openGlobal = root.classList.toggle('nav-open');
          // reflect the local open state (they should stay in sync)
          btn.setAttribute('aria-expanded', String(openLocal || openGlobal));
        });
        nav && nav.addEventListener('click', (e)=>{ if(e.target.tagName==='A'){ header.classList.remove('nav-open'); root.classList.remove('nav-open'); btn.setAttribute('aria-expanded','false'); } });
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ header.classList.remove('nav-open'); root.classList.remove('nav-open'); btn.setAttribute('aria-expanded','false'); } });
      })();
    </script>

    <main class="main-content">
      <section class="section">
        <h2 class="section-title">Add Expense</h2>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <input id="expense-desc" placeholder="Description" style="flex:1;padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)">
          <input id="expense-amount" placeholder="Amount" type="number" step="0.01" style="width:120px;padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)">
          <input id="expense-cat" placeholder="Category" style="width:140px;padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text)">
          <button id="add-expense" class="add-btn">+</button>
        </div>
      </section>

      <section class="section">
        <h2 class="section-title">Expenses</h2>
        <ul id="expenses-list" style="list-style:none;display:flex;flex-direction:column;gap:8px;padding:0"></ul>
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;justify-content:space-between;">
          <div id="expenses-total" style="font-weight:600;color:var(--accent)">Total: $0.00</div>
          <div style="display:flex;gap:8px">
            <button id="clear-expenses" class="clear-all-btn">Clear All</button>
            <button onclick="location.href='index.html'" class="add-btn">Back</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Simple expense tracker using localStorage
    const listEl = document.getElementById('expenses-list');
    const totalEl = document.getElementById('expenses-total');
    const desc = document.getElementById('expense-desc');
    const amount = document.getElementById('expense-amount');
    const cat = document.getElementById('expense-cat');
    const ADD_KEY = 'dailyplanner:expenses';

    function loadExpenses(){
      try{ return JSON.parse(localStorage.getItem(ADD_KEY))||[] }catch(e){return[]}
    }

    function saveExpenses(arr){ localStorage.setItem(ADD_KEY, JSON.stringify(arr)); }

    function render(){
      const items = loadExpenses();
      listEl.innerHTML = '';
      let total = 0;
      items.forEach((it,idx)=>{
        total += Number(it.amount||0);
        const li = document.createElement('li');
        li.style.display='flex'; li.style.justifyContent='space-between'; li.style.alignItems='center';
        li.innerHTML = `<div><strong>${escapeHtml(it.desc)}</strong> <span style="color:var(--muted)">(${escapeHtml(it.cat)})</span></div><div style="display:flex;gap:8px;align-items:center"><div>$${Number(it.amount).toFixed(2)}</div><button data-idx="${idx}" class="todo-delete">×</button></div>`;
        listEl.appendChild(li);
      });
      totalEl.textContent = 'Total: $' + total.toFixed(2);
    }

    function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

    document.getElementById('add-expense').addEventListener('click', ()=>{
      const d=desc.value.trim(); const a=Number(amount.value||0); const c=cat.value.trim();
      if(!d||!a) return;
      const arr = loadExpenses(); arr.push({desc:d,amount:a,cat:c||''}); saveExpenses(arr); desc.value=''; amount.value=''; cat.value=''; render();
    });

    document.getElementById('clear-expenses').addEventListener('click', ()=>{ if(confirm('Clear all expenses?')){ saveExpenses([]); render(); } });

    listEl.addEventListener('click', (e)=>{ if(e.target.dataset.idx){ const i=Number(e.target.dataset.idx); const arr=loadExpenses(); arr.splice(i,1); saveExpenses(arr); render(); } });

    render();

    // Date picker and weekday functionality
    (function() {
      const datePicker = document.getElementById('date-picker');
      const weekdayBtns = document.querySelectorAll('.weekday-btn');
      let currentDate = new Date();

      // Format date to YYYY-MM-DD string
      function formatDate(date) {
        return date.toISOString().split('T')[0];
      }

      // Get weekday number (0 = Sunday, 1 = Monday, etc.)
      function getWeekday(date) {
        return date.getDay();
      }

      // Update weekday buttons to show current day
      function updateWeekdayButtons() {
        const currentWeekday = getWeekday(currentDate);
        
        weekdayBtns.forEach(btn => {
          const day = parseInt(btn.dataset.day);
          btn.classList.toggle('active', day === currentWeekday);
        });
      }

      // Go to specific weekday
      function goToWeekday(targetDay) {
        const currentWeekday = getWeekday(currentDate);
        const diff = targetDay - currentWeekday;
        
        currentDate.setDate(currentDate.getDate() + diff);
        datePicker.value = formatDate(currentDate);
        updateWeekdayButtons();
      }

      // Initialize
      if (datePicker) {
        datePicker.value = formatDate(currentDate);
        updateWeekdayButtons();
        
        // Date picker change event
        datePicker.addEventListener('change', (e) => {
          currentDate = new Date(e.target.value);
          updateWeekdayButtons();
        });
      }

      // Weekday button events
      weekdayBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          const day = parseInt(e.target.dataset.day);
          goToWeekday(day);
        });
      });
    })();
  </script>

  <!-- Authentication Modal -->
  <div id="auth-modal" class="auth-modal" style="display: none;">
    <div class="auth-modal-content">
      <div class="auth-modal-header">
        <button type="button" class="auth-modal-close" aria-label="Close modal">&times;</button>
        <h3>Sign In</h3>
      </div>
      <div class="auth-tabs">
        <button type="button" class="auth-tab active" data-tab="signin">Sign In</button>
        <button type="button" class="auth-tab" data-tab="signup">Sign Up</button>
      </div>
      
      <!-- Sign In Form -->
      <form id="signin-form" class="auth-form">
        <div class="form-group">
          <label for="signin-email">Email</label>
          <input type="email" id="signin-email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="signin-password">Password</label>
          <input type="password" id="signin-password" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="auth-submit-btn">Sign In</button>
        <div id="signin-error" class="auth-error" style="display: none;"></div>
      </form>

      <!-- Sign Up Form -->
      <form id="signup-form" class="auth-form" style="display: none;">
        <div class="form-group">
          <label for="signup-email">Email</label>
          <input type="email" id="signup-email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="signup-password">Password</label>
          <input type="password" id="signup-password" placeholder="Create a password (min 6 characters)" required minlength="6">
        </div>
        <div class="form-group">
          <label for="signup-confirm">Confirm Password</label>
          <input type="password" id="signup-confirm" placeholder="Confirm your password" required>
        </div>
        <button type="submit" class="auth-submit-btn">Sign Up</button>
        <div id="signup-error" class="auth-error" style="display: none;"></div>
      </form>

      <div class="auth-divider">
        <span>or</span>
      </div>
      
      <button type="button" id="google-signin-btn" class="google-signin-btn">
        <svg width="18" height="18" viewBox="0 0 18 18">
          <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 002.38-5.88c0-.57-.05-.66-.15-1.18z"/>
          <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2.04a4.8 4.8 0 01-7.18-2.53H1.83v2.07A8 8 0 008.98 17z"/>
          <path fill="#FBBC05" d="M4.5 10.49a4.8 4.8 0 010-3.02V5.4H1.83a8 8 0 000 7.17l2.67-2.08z"/>
          <path fill="#EA4335" d="M8.98 4.72c1.16 0 2.19.4 3.01 1.2l2.26-2.26A7.6 7.6 0 008.98 1a8 8 0 00-7.15 4.4l2.67 2.07c.64-1.94 2.4-3.75 4.48-3.75z"/>
        </svg>
        Continue with Google
      </button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      createUserWithEmailAndPassword, 
      signInWithPopup, 
      GoogleAuthProvider, 
      signOut, 
      onAuthStateChanged,
      updateProfile
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    
    // Initialize Firebase
    async function initializeFirebase() {
      // Try to load Firebase config from separate file
      let firebaseConfig;
      try {
        const configModule = await import('./firebase-config.js');
        firebaseConfig = configModule.firebaseConfig;
        console.log('✅ Loaded Firebase config from file');
      } catch (error) {
        console.warn('⚠️ No Firebase config file found, using localStorage only');
        return;
      }

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider();

    // Make Firebase available globally
    window.firebase = { app, db, auth, googleProvider, updateProfile };
    
    // Authentication state change handler
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log('User signed in:', user.uid, user.email);
        updateAuthUI(user);
      } else {
        console.log('No user signed in');
        updateAuthUI(null);
      }
    });

    // Authentication UI management
    function updateAuthUI(user) {
      const signInBtn = document.getElementById('sign-in-btn');
      const signOutBtn = document.getElementById('sign-out-btn');
      const userEmail = document.getElementById('user-email');
      const authModal = document.getElementById('auth-modal');

      if (user) {
        // User is signed in
        if (signInBtn) signInBtn.style.display = 'none';
        if (signOutBtn) signOutBtn.style.display = 'block';
        if (userEmail) {
          userEmail.textContent = user.email || 'Anonymous User';
          userEmail.style.display = 'block';
        }
        if (authModal) authModal.style.display = 'none';
      } else {
        // User is not signed in
        if (signInBtn) signInBtn.style.display = 'block';
        if (signOutBtn) signOutBtn.style.display = 'none';
        if (userEmail) {
          userEmail.textContent = '';
          userEmail.style.display = 'none';
        }
      }
    }

    // Authentication functions
    window.authFunctions = {
      async signIn(email, password) {
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          console.log('Signed in:', userCredential.user);
          return userCredential;
        } catch (error) {
          console.error('Sign in error:', error);
          throw error;
        }
      },

      async signUp(email, password) {
        try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          console.log('Signed up:', userCredential.user);
          return userCredential;
        } catch (error) {
          console.error('Sign up error:', error);
          throw error;
        }
      },

      async signInWithGoogle() {
        try {
          const result = await signInWithPopup(auth, googleProvider);
          console.log('Google sign in:', result.user);
          return result;
        } catch (error) {
          console.error('Google sign in error:', error);
          throw error;
        }
      },

      async signOut() {
        try {
          await signOut(auth);
          console.log('Signed out');
        } catch (error) {
          console.error('Sign out error:', error);
          throw error;
        }
      }
    };
    }
    
    // Call the initialization function
    initializeFirebase();
  </script>
  
  <script src="script.js"></script>
</body>
</html>
