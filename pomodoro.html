<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pomodoro</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
    <header class="header">
      <h1 class="title">POMODORO</h1>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation"></button>
      <nav class="app-nav" aria-label="App navigation">
      <a href="index.html">Planner</a>
      <a href="habit-builder.html">Habits</a>
      <a href="expense-tracker.html">Expenses</a>
      <a href="pomodoro.html" class="active">Pomodoro</a>
      <a href="work.html">Work</a>
      <button type="button" id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light mode">
        <span class="theme-icon">ðŸŒ™</span>
        <span class="theme-text">Dark Mode</span>
      </button>
    </nav>
    </header>
    <section class="calendar-section">
      <div class="calendar-top">
        <div class="date-controls">
          <div class="date-input-row">
            <label for="date-picker" class="sr-only">Select date</label>
            <input type="date" id="date-picker" class="date-picker" aria-label="Select date">
          </div>
        </div>
      </div>

      <div class="calendar-bottom">
        <div class="weekday-toggles" role="group" aria-label="Weekday selection">
          <button type="button" class="weekday-btn" data-day="1">M</button>
          <button type="button" class="weekday-btn" data-day="2">T</button>
          <button type="button" class="weekday-btn" data-day="3">W</button>
          <button type="button" class="weekday-btn" data-day="4">T</button>
          <button type="button" class="weekday-btn" data-day="5">F</button>
          <button type="button" class="weekday-btn" data-day="6">S</button>
          <button type="button" class="weekday-btn" data-day="0">S</button>
        </div>
      </div>
    </section>
    <!-- Pomodoro clock UI -->
    <div class="clock" aria-label="Pomodoro clock">
      <div class="timer">
        <div class="progress-wrap">
          <!-- SVG circle progress for smooth animation -->
          <svg class="progress-svg" viewBox="0 0 100 100" aria-hidden="true" focusable="false">
            <circle class="progress-bg" cx="50" cy="50" r="44" fill="none" stroke-width="6"></circle>
            <circle id="progress-circle" class="progress-fg session" cx="50" cy="50" r="44" fill="none" stroke-width="6" stroke-linecap="round" stroke-dasharray="276.46" stroke-dashoffset="276.46"></circle>
          </svg>
          <div id="main-display" class="main-display">25:00</div>
        </div>
      </div>

      <div class="session-info">
        <div class="session-count"><h2>Pomodoro</h2></div>
      </div>

      <div class="settings">
        <div class="time-session">
          <h6>Session</h6>
          <div class="time-session-display">25 min</div>
          <div class="control-row">
            <button class="btn small minus" id="sess-minus" aria-label="Decrease session">-</button>
            <button class="btn small plus" id="sess-plus" aria-label="Increase session">+</button>
          </div>
        </div>
        <div class="time-break">
          <h6>Break</h6>
          <div class="time-break-display">5 min</div>
          <div class="control-row">
            <button class="btn small minus" id="break-minus" aria-label="Decrease break">-</button>
            <button class="btn small plus" id="break-plus" aria-label="Increase break">+</button>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn time-start" id="time-start" aria-pressed="false">Start</button>
        <button class="btn time-reset" id="time-reset">Reset</button>
      </div>
    </div>

    <script>
      (function(){
        // Nav toggle (keeps existing behavior)
        const header = document.querySelector('.header');
        const btn = document.getElementById('nav-toggle');
        const root = document.documentElement;
        if (btn && header) {
          btn.setAttribute('aria-expanded','false');
          btn.addEventListener('click', ()=>{
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
            header.classList.toggle('nav-open');
            root.classList.toggle('nav-open');
          });
          // click-outside-to-close
          document.addEventListener('click', (e)=>{
            const nav = document.querySelector('.app-nav');
            if (!nav) return;
            if (!nav.contains(e.target) && !btn.contains(e.target) && header.classList.contains('nav-open')){
              header.classList.remove('nav-open');
              root.classList.remove('nav-open');
              btn.setAttribute('aria-expanded','false');
            }
          });
        }

        // Pomodoro controller
        const $ = (s) => document.querySelector(s);
        const $$ = (s) => Array.from(document.querySelectorAll(s));

  const progressEl = document.getElementById('progress-circle');
        const displayEl = $('#main-display');
        const sessDisplay = $('.time-session-display');
        const breakDisplay = $('.time-break-display');
        const startBtn = $('#time-start');
        const resetBtn = $('#time-reset');

        let sessionMinutes = 25;
        let breakMinutes = 5;
        let remaining = sessionMinutes * 60;
        let isRunning = false;
        let isBreak = false;
        let timerId = null;

        function formatTime(secs){
          const m = Math.floor(secs/60).toString().padStart(2,'0');
          const s = Math.floor(secs%60).toString().padStart(2,'0');
          return `${m}:${s}`;
        }

        function render(){
          displayEl.textContent = formatTime(remaining);
          sessDisplay.textContent = `${sessionMinutes} min`;
          breakDisplay.textContent = `${breakMinutes} min`;
          const total = (isBreak ? breakMinutes*60 : sessionMinutes*60);
          const pct = Math.max(0, Math.min(100, ((total - remaining)/total) * 100));
          // update SVG stroke-dashoffset for smooth animation
          if (progressEl) {
            const r = progressEl.getAttribute('r');
            const radius = Number(r);
            const circumference = 2 * Math.PI * radius;
            const offset = circumference * (1 - pct / 100);
            progressEl.style.transition = 'stroke-dashoffset 0.4s linear';
            progressEl.style.strokeDasharray = `${circumference}`;
            progressEl.style.strokeDashoffset = `${offset}`;
            progressEl.classList.toggle('break', isBreak);
          }
        }

        function tick(){
          if(remaining > 0){
            remaining -= 1;
            render();
          } else {
            // switch modes
            isBreak = !isBreak;
            remaining = (isBreak ? breakMinutes*60 : sessionMinutes*60);
            render();
          }
        }

        function start(){
          if(isRunning) return;
          isRunning = true;
          startBtn.textContent = 'Pause';
          startBtn.setAttribute('aria-pressed','true');
          timerId = setInterval(tick, 1000);
        }
        function pause(){
          if(!isRunning) return;
          isRunning = false;
          startBtn.textContent = 'Start';
          startBtn.setAttribute('aria-pressed','false');
          clearInterval(timerId);
        }
        function reset(){
          pause();
          isBreak = false;
          remaining = sessionMinutes * 60;
          render();
        }

        // Controls
        startBtn && startBtn.addEventListener('click', ()=>{
          if(isRunning) pause(); else start();
        });
        resetBtn && resetBtn.addEventListener('click', ()=> reset());

        // session / break adjusters
        $('#sess-plus') && $('#sess-plus').addEventListener('click', ()=>{
          sessionMinutes = Math.min(60, sessionMinutes + 1);
          if(!isRunning && !isBreak) remaining = sessionMinutes*60;
          render();
        });
        $('#sess-minus') && $('#sess-minus').addEventListener('click', ()=>{
          sessionMinutes = Math.max(1, sessionMinutes - 1);
          if(!isRunning && !isBreak) remaining = sessionMinutes*60;
          render();
        });
        $('#break-plus') && $('#break-plus').addEventListener('click', ()=>{
          breakMinutes = Math.min(30, breakMinutes + 1);
          if(!isRunning && isBreak) remaining = breakMinutes*60;
          render();
        });
        $('#break-minus') && $('#break-minus').addEventListener('click', ()=>{
          breakMinutes = Math.max(1, breakMinutes - 1);
          if(!isRunning && isBreak) remaining = breakMinutes*60;
          render();
        });

        // initial render
        render();
      })();

      // Date picker and weekday functionality
      (function() {
        const datePicker = document.getElementById('date-picker');
        const weekdayBtns = document.querySelectorAll('.weekday-btn');
        let currentDate = new Date();

        // Format date to YYYY-MM-DD string
        function formatDate(date) {
          return date.toISOString().split('T')[0];
        }

        // Get weekday number (0 = Sunday, 1 = Monday, etc.)
        function getWeekday(date) {
          return date.getDay();
        }

        // Update weekday buttons to show current day
        function updateWeekdayButtons() {
          const currentWeekday = getWeekday(currentDate);
          
          weekdayBtns.forEach(btn => {
            const day = parseInt(btn.dataset.day);
            btn.classList.toggle('active', day === currentWeekday);
          });
        }

        // Go to specific weekday
        function goToWeekday(targetDay) {
          const currentWeekday = getWeekday(currentDate);
          const diff = targetDay - currentWeekday;
          
          currentDate.setDate(currentDate.getDate() + diff);
          datePicker.value = formatDate(currentDate);
          updateWeekdayButtons();
        }

        // Initialize
        if (datePicker) {
          datePicker.value = formatDate(currentDate);
          updateWeekdayButtons();
          
          // Date picker change event
          datePicker.addEventListener('change', (e) => {
            currentDate = new Date(e.target.value);
            updateWeekdayButtons();
          });
        }

        // Weekday button events
        weekdayBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            const day = parseInt(e.target.dataset.day);
            goToWeekday(day);
          });
        });
      })();
    </script>
    <script src="script.js"></script>

  </div>
  </body>
  </html>
