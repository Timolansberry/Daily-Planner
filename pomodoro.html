<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pomodoro</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e74c3c'%3E%3Cellipse cx='12' cy='14' rx='8' ry='6' fill='%23e74c3c'/%3E%3Cpath d='M8 8h8v6c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2V8z' fill='%23c0392b'/%3E%3Cpath d='M12 6c-1.1 0-2 .9-2 2v2h4V8c0-1.1-.9-2-2-2z' fill='%23a93226'/%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e74c3c'%3E%3Cellipse cx='12' cy='14' rx='8' ry='6' fill='%23e74c3c'/%3E%3Cpath d='M8 8h8v6c0 1.1-.9 2-2 2h-4c-1.1 0-2-.9-2-2V8z' fill='%23c0392b'/%3E%3Cpath d='M12 6c-1.1 0-2 .9-2 2v2h4V8c0-1.1-.9-2-2-2z' fill='%23a93226'/%3E%3C/svg%3E">
  
  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
    <header class="header">
      <!-- Mobile User Profile Icon - Left side next to hamburger -->
      <div class="mobile-user-profile-icon">
          <div id="mobile-user-email" class="mobile-user-email"></div>
      </div>
      
      <!-- User Info Menu - Slides from left -->
      <div id="user-info-menu" class="user-info-menu" style="display: none;">
          <div class="user-info-menu-header">
              <h3>Account Information</h3>
              <button type="button" id="user-info-close-btn" class="user-info-close-btn" aria-label="Close user info">×</button>
          </div>
          <div class="user-info-menu-content">
              <div class="info-row">
                  <label>Email:</label>
                  <span id="menu-email">Loading...</span>
              </div>
              <div class="info-row">
                  <label>User Name:</label>
                  <input type="text" id="menu-display-name" class="menu-input" placeholder="Enter name">
              </div>
              <div class="info-row">
                  <label>Account Created:</label>
                  <span id="menu-created">Loading...</span>
              </div>
          </div>
          <div class="user-info-menu-actions">
              <button type="button" id="menu-save-btn" class="menu-save-btn">Save Changes</button>
              <button type="button" id="menu-logout-btn" class="menu-logout-btn">Log Out</button>
              <button type="button" id="menu-delete-btn" class="menu-delete-btn">Delete Account</button>
          </div>
      </div>
      
      <!-- User Info Menu Backdrop -->
      <div id="user-info-menu-backdrop" class="user-info-menu-backdrop"></div>
      
      <h1 class="title">POMODORO</h1>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation"></button>
            <nav class="app-nav" aria-label="App navigation">
                <a href="index.html">Planner</a>
                <a href="habit-builder.html">Habits</a>
                <a href="expense-tracker.html">Expenses</a>
                <a href="pomodoro.html" class="active">Pomodoro</a>
                <a href="work.html">Work</a>
      <div class="nav-controls">
        <button type="button" id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light mode">
          <span class="theme-icon">🌙</span>
          <span class="theme-text">Dark Mode</span>
        </button>
        <div class="auth-section">
          <div id="auth-status" class="auth-status">
            <span id="user-email" class="user-email"></span>
            <button type="button" id="sign-out-btn" class="sign-out-btn" style="display: none;">Sign Out</button>
            
            <!-- User Info Dropdown -->
            <div id="user-info-dropdown" class="user-info-dropdown" style="display: none;">
                <div class="user-info-header">
                    <h3>Account Information</h3>
                </div>
        <div class="user-info-content">
          <div class="info-row">
            <label>Email:</label>
            <span id="dropdown-email">Loading...</span>
          </div>
          <div class="info-row">
            <label>User Name:</label>
            <input type="text" id="dropdown-display-name" class="dropdown-input" placeholder="Enter name">
          </div>
          <div class="info-row">
            <label>Account Created:</label>
            <span id="dropdown-created">Loading...</span>
          </div>
        </div>
                <div class="user-info-actions">
                    <button type="button" id="save-user-info-btn" class="save-user-info-btn">Save Changes</button>
                    <button type="button" id="dropdown-logout-btn" class="dropdown-logout-btn">Log Out</button>
                    <button type="button" id="delete-account-btn" class="delete-account-btn">Delete Account</button>
                </div>
            </div>
          </div>
          <button type="button" id="sign-in-btn" class="sign-in-btn" style="display: none;">Sign In</button>
        </div>
      </div>
    </nav>
    </header>
    <!-- Pomodoro clock UI -->
    <div class="clock" aria-label="Pomodoro clock">
      <div class="timer">
        <div class="progress-wrap">
          <!-- SVG circle progress for smooth animation -->
          <svg class="progress-svg" viewBox="0 0 100 100" aria-hidden="true" focusable="false">
            <circle class="progress-bg" cx="50" cy="50" r="44" fill="none" stroke-width="6"></circle>
            <circle id="progress-circle" class="progress-fg session" cx="50" cy="50" r="44" fill="none" stroke-width="6" stroke-linecap="round" stroke-dasharray="276.46" stroke-dashoffset="276.46"></circle>
          </svg>
          <div id="main-display" class="main-display">
            <div class="time-text">25:00</div>
            <div class="status-text">FOCUS</div>
            <button class="btn internal-start-btn" id="time-start" aria-pressed="false">
              <span class="play-icon">▶</span>
            </button>
          </div>
        </div>
      </div>

      <div class="settings">
        <div class="time-session">
          <h6>Session</h6>
          <div class="time-session-display">25 min</div>
          <div class="control-row">
            <button class="btn small minus" id="sess-minus" aria-label="Decrease session">-</button>
            <button class="btn small plus" id="sess-plus" aria-label="Increase session">+</button>
          </div>
        </div>
        <div class="time-break">
          <h6>Break</h6>
          <div class="time-break-display">5 min</div>
          <div class="control-row">
            <button class="btn small minus" id="break-minus" aria-label="Decrease break">-</button>
            <button class="btn small plus" id="break-plus" aria-label="Increase break">+</button>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn time-reset" id="time-reset">Reset</button>
      </div>
      
      <!-- Settings gear icon -->
      <button class="settings-gear-btn" id="settings-gear" aria-label="Open settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
      
      <!-- Hamburger menu icon -->
      <button class="hamburger-menu-btn" id="hamburger-menu" aria-label="Open navigation menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
      
      <!-- Settings modal -->
      <div id="settings-modal" class="settings-modal" style="display: none;">
        <div class="settings-modal-content">
          <div class="settings-modal-header">
            <h3>Timer Settings</h3>
            <button class="settings-close-btn" id="settings-close" aria-label="Close settings">×</button>
          </div>
          <div class="settings-content">
            <div class="setting-group">
              <label>Session Duration</label>
              <div class="time-controls">
                <button class="btn small minus" id="sess-minus" aria-label="Decrease session">-</button>
                <span class="time-display" id="session-display">25 min</span>
                <button class="btn small plus" id="sess-plus" aria-label="Increase session">+</button>
              </div>
            </div>
            <div class="setting-group">
              <label>Break Duration</label>
              <div class="time-controls">
                <button class="btn small minus" id="break-minus" aria-label="Decrease break">-</button>
                <span class="time-display" id="break-display">5 min</span>
                <button class="btn small plus" id="break-plus" aria-label="Increase break">+</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function(){
        // Nav toggle (keeps existing behavior)
        const header = document.querySelector('.header');
        const btn = document.getElementById('nav-toggle');
        const root = document.documentElement;
        if (btn && header) {
          btn.setAttribute('aria-expanded','false');
          btn.addEventListener('click', ()=>{
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
            header.classList.toggle('nav-open');
            root.classList.toggle('nav-open');
          });
          // click-outside-to-close
          document.addEventListener('click', (e)=>{
            const nav = document.querySelector('.app-nav');
            if (!nav) return;
            if (!nav.contains(e.target) && !btn.contains(e.target) && header.classList.contains('nav-open')){
              header.classList.remove('nav-open');
              root.classList.remove('nav-open');
              btn.setAttribute('aria-expanded','false');
            }
          });
        }

        // Pomodoro controller
        const $ = (s) => document.querySelector(s);
        const $$ = (s) => Array.from(document.querySelectorAll(s));

  const progressEl = document.getElementById('progress-circle');
        const displayEl = $('#main-display');
        const sessDisplay = $('.time-session-display');
        const breakDisplay = $('.time-break-display');
        const startBtn = $('#time-start');
        const resetBtn = $('#time-reset');

        let sessionMinutes = 25;
        let breakMinutes = 5;
        let remaining = sessionMinutes * 60;
        let isRunning = false;
        let isBreak = false;
        let timerId = null;

        function formatTime(secs){
          const m = Math.floor(secs/60).toString().padStart(2,'0');
          const s = Math.floor(secs%60).toString().padStart(2,'0');
          return `${m}:${s}`;
        }

        function render(){
          // Update time display
          const timeText = displayEl.querySelector('.time-text');
          if (timeText) timeText.textContent = formatTime(remaining);
          
          // Update status text
          const statusText = displayEl.querySelector('.status-text');
          if (statusText) statusText.textContent = isBreak ? 'BREAK' : 'FOCUS';
          
          // Update play/pause button
          const playIcon = document.querySelector('.play-icon');
          if (playIcon) {
            playIcon.textContent = isRunning ? '⏸' : '▶';
          }
          
          // Update settings modal displays
          const sessionDisplay = document.getElementById('session-display');
          const breakDisplay = document.getElementById('break-display');
          if (sessionDisplay) sessionDisplay.textContent = `${sessionMinutes} min`;
          if (breakDisplay) breakDisplay.textContent = `${breakMinutes} min`;
          const total = (isBreak ? breakMinutes*60 : sessionMinutes*60);
          const pct = Math.max(0, Math.min(100, ((total - remaining)/total) * 100));
          // update SVG stroke-dashoffset for smooth animation
          if (progressEl) {
            const r = progressEl.getAttribute('r');
            const radius = Number(r);
            const circumference = 2 * Math.PI * radius;
            const offset = circumference * (1 - pct / 100);
            // Use CSS transition instead of inline style for smoother animation
            progressEl.style.strokeDasharray = `${circumference}`;
            progressEl.style.strokeDashoffset = `${offset}`;
            progressEl.classList.toggle('break', isBreak);
          }
        }

        function tick(){
          if(remaining > 0){
            remaining -= 1;
            render();
          } else {
            // switch modes
            isBreak = !isBreak;
            remaining = (isBreak ? breakMinutes*60 : sessionMinutes*60);
            render();
          }
        }

        function start(){
          if(isRunning) return;
          isRunning = true;
          startBtn.setAttribute('aria-pressed','true');
          timerId = setInterval(tick, 1000);
          render(); // Update the button icon immediately
        }
        function pause(){
          if(!isRunning) return;
          isRunning = false;
          startBtn.setAttribute('aria-pressed','false');
          clearInterval(timerId);
          render(); // Update the button icon immediately
        }
        function reset(){
          pause();
          isBreak = false;
          remaining = sessionMinutes * 60;
          render();
        }

        // Controls
        startBtn && startBtn.addEventListener('click', ()=>{
          if(isRunning) pause(); else start();
        });
        resetBtn && resetBtn.addEventListener('click', ()=> reset());

        // session / break adjusters
        $('#sess-plus') && $('#sess-plus').addEventListener('click', ()=>{
          sessionMinutes = Math.min(60, sessionMinutes + 1);
          if(!isRunning && !isBreak) remaining = sessionMinutes*60;
          render();
        });
        $('#sess-minus') && $('#sess-minus').addEventListener('click', ()=>{
          sessionMinutes = Math.max(1, sessionMinutes - 1);
          if(!isRunning && !isBreak) remaining = sessionMinutes*60;
          render();
        });
        $('#break-plus') && $('#break-plus').addEventListener('click', ()=>{
          breakMinutes = Math.min(30, breakMinutes + 1);
          if(!isRunning && isBreak) remaining = breakMinutes*60;
          render();
        });
        $('#break-minus') && $('#break-minus').addEventListener('click', ()=>{
          breakMinutes = Math.max(1, breakMinutes - 1);
          if(!isRunning && isBreak) remaining = breakMinutes*60;
          render();
        });

        // Settings modal functionality
        const settingsGear = document.getElementById('settings-gear');
        const settingsModal = document.getElementById('settings-modal');
        const settingsClose = document.getElementById('settings-close');
        
        settingsGear.addEventListener('click', () => {
          settingsModal.style.display = 'flex';
        });
        
        settingsClose.addEventListener('click', () => {
          settingsModal.style.display = 'none';
        });
        
        // Close modal when clicking outside
        settingsModal.addEventListener('click', (e) => {
          if (e.target === settingsModal) {
            settingsModal.style.display = 'none';
          }
        });
        
        // Hamburger menu functionality
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const navToggle = document.getElementById('nav-toggle');
        
        hamburgerMenu.addEventListener('click', () => {
          // Trigger the existing navigation toggle
          if (navToggle) {
            navToggle.click();
          }
        });

        // initial render
        render();
      })();
    </script>
    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal" style="display: none;">
      <div class="auth-modal-content">
        <div class="auth-modal-header">
          <button type="button" class="auth-modal-close" aria-label="Close modal">&times;</button>
          <h3>Sign In</h3>
        </div>
        <div class="auth-tabs">
          <button type="button" class="auth-tab active" data-tab="signin">Sign In</button>
          <button type="button" class="auth-tab" data-tab="signup">Sign Up</button>
        </div>
        
        <!-- Sign In Form -->
        <form id="signin-form" class="auth-form">
          <div class="form-group">
            <label for="signin-email">Email</label>
            <input type="email" id="signin-email" placeholder="Enter your email" required>
          </div>
          <div class="form-group">
            <label for="signin-password">Password</label>
            <input type="password" id="signin-password" placeholder="Enter your password" required>
          </div>
          <button type="submit" class="auth-submit-btn">Sign In</button>
          <div id="signin-error" class="auth-error" style="display: none;"></div>
        </form>

        <!-- Sign Up Form -->
        <form id="signup-form" class="auth-form" style="display: none;">
          <div class="form-group">
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" placeholder="Enter your email" required>
          </div>
          <div class="form-group">
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" placeholder="Create a password (min 6 characters)" required minlength="6">
          </div>
          <div class="form-group">
            <label for="signup-confirm">Confirm Password</label>
            <input type="password" id="signup-confirm" placeholder="Confirm your password" required>
          </div>
          <button type="submit" class="auth-submit-btn">Sign Up</button>
          <div id="signup-error" class="auth-error" style="display: none;"></div>
        </form>

        <div class="auth-divider">
          <span>or</span>
        </div>
        
        <button type="button" id="google-signin-btn" class="google-signin-btn">
          <svg width="18" height="18" viewBox="0 0 18 18">
            <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 002.38-5.88c0-.57-.05-.66-.15-1.18z"/>
            <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2.04a4.8 4.8 0 01-7.18-2.53H1.83v2.07A8 8 0 008.98 17z"/>
            <path fill="#FBBC05" d="M4.5 10.49a4.8 4.8 0 010-3.02V5.4H1.83a8 8 0 000 7.17l2.67-2.08z"/>
            <path fill="#EA4335" d="M8.98 4.72c1.16 0 2.19.4 3.01 1.2l2.26-2.26A7.6 7.6 0 008.98 1a8 8 0 00-7.15 4.4l2.67 2.07c.64-1.94 2.4-3.75 4.48-3.75z"/>
          </svg>
          Continue with Google
        </button>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getDatabase } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
      import { 
        getAuth, 
        signInWithEmailAndPassword, 
        createUserWithEmailAndPassword, 
        signInWithPopup, 
        GoogleAuthProvider, 
        signOut, 
        onAuthStateChanged,
        updateProfile
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      
      // Initialize Firebase
      async function initializeFirebase() {
        // Try to load Firebase config from separate file
        let firebaseConfig;
        try {
          const configModule = await import('./firebase-config.js');
          firebaseConfig = configModule.firebaseConfig;
          console.log('✅ Loaded Firebase config from file');
        } catch (error) {
          console.warn('⚠️ No Firebase config file found, using localStorage only');
          return;
        }

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);
      const googleProvider = new GoogleAuthProvider();

      // Make Firebase available globally
      window.firebase = { app, db, auth, googleProvider, updateProfile };
      
      // Track if user was previously signed in to avoid reload loop on initial load
      let wasUserSignedIn = false;
      
      // Authentication state change handler
      onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User signed in:', user.uid, user.email);
                wasUserSignedIn = true;
                updateAuthUI(user);
                
                // Clear local data to ensure clean Firebase-only experience
                if (window.storage && window.storage.clearLocalData) {
                    window.storage.clearLocalData();
                    console.log('Local data cleared on login');
                }
                
                // Initialize Firebase storage
                if (window.initWithFirebase) {
                    window.initWithFirebase(user.uid);
                }
        } else {
          console.log('No user signed in');
          updateAuthUI(null);
          
          // Only clear data and refresh if user was previously signed in (actual logout)
          if (wasUserSignedIn) {
            // Clear local data and reset app state when user logs out
            if (window.storage && window.storage.clearLocalData) {
              window.storage.clearLocalData();
              console.log('Local data cleared on logout');
            }
            
            // Reset to empty plan and re-render
            if (window.plannerApp && window.currentPlan) {
              window.currentPlan = window.getEmptyPlan();
              window.plannerApp.renderAll();
              console.log('App state reset on logout');
            }
            
            // Refresh the page to ensure clean UI state
            setTimeout(() => {
              window.location.reload();
            }, 100);
          }
          wasUserSignedIn = false;
        }
      });

      // Authentication UI management
      function updateAuthUI(user) {
        console.log('updateAuthUI called with user:', user);
        const signInBtn = document.getElementById('sign-in-btn');
        const signOutBtn = document.getElementById('sign-out-btn');
        const userEmail = document.getElementById('user-email');
        const mobileUserEmail = document.getElementById('mobile-user-email');
        const authModal = document.getElementById('auth-modal');
        const userInfoDropdown = document.getElementById('user-info-dropdown');
        const userInfoMenu = document.getElementById('user-info-menu');

        console.log('Auth elements found:', { signInBtn, signOutBtn, userEmail, mobileUserEmail, authModal });

        if (user) {
          // User is signed in
          console.log('User is signed in, updating UI...');
          if (signInBtn) signInBtn.style.display = 'none';
          if (signOutBtn) signOutBtn.style.display = 'none'; // Hide sign out button
          if (userEmail) {
            // Show person icon instead of name
            userEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
            userEmail.style.display = 'block';
          }
          if (mobileUserEmail) {
            // Show person icon in mobile nav
            mobileUserEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
            mobileUserEmail.style.display = 'block';
          }
          if (authModal) authModal.style.display = 'none';
          
          // Hide account info sections initially (they'll be shown when user clicks the person icon)
          if (userInfoDropdown) userInfoDropdown.style.display = 'none';
          if (userInfoMenu) userInfoMenu.style.display = 'none';
          
          // Restore account info content for signed in users
          restoreAccountInfoForSignedInUser();
        } else {
          // User is not signed in
          console.log('User is not signed in, showing sign in button...');
          if (signInBtn) signInBtn.style.display = 'block';
          if (signOutBtn) signOutBtn.style.display = 'none';
          if (userEmail) {
            userEmail.textContent = '';
            userEmail.style.display = 'none';
          }
          if (mobileUserEmail) {
            // Always show mobile user profile icon on mobile devices, even when not signed in
            mobileUserEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
            mobileUserEmail.style.display = 'block';
          }
          
          // Hide account info sections when user is not signed in
          if (userInfoDropdown) userInfoDropdown.style.display = 'none';
          if (userInfoMenu) userInfoMenu.style.display = 'none';
          
          // Show sign-in/sign-up content in account info section
          updateAccountInfoForSignedOutUser();
        }
      }

      // Restore account info content for signed in users
      function restoreAccountInfoForSignedInUser() {
        const userInfoDropdown = document.getElementById('user-info-dropdown');
        const userInfoMenu = document.getElementById('user-info-menu');
        
        if (userInfoDropdown) {
          // Restore the original account info content
          const header = userInfoDropdown.querySelector('.user-info-header h3');
          const content = userInfoDropdown.querySelector('.user-info-content');
          const actions = userInfoDropdown.querySelector('.user-info-actions');
          
          if (header) header.textContent = 'Account Information';
          if (content) {
            content.innerHTML = `
              <div class="info-row">
                <label>Email:</label>
                <span id="dropdown-email">Loading...</span>
              </div>
              <div class="info-row">
                <label>User Name:</label>
                <input type="text" id="dropdown-display-name" class="dropdown-input" placeholder="Enter name">
              </div>
              <div class="info-row">
                <label>Account Created:</label>
                <span id="dropdown-created">Loading...</span>
              </div>
            `;
          }
          if (actions) actions.style.display = 'block';
        }
        
        if (userInfoMenu) {
          // Same for mobile menu
          const header = userInfoMenu.querySelector('.user-info-menu-header h3');
          const content = userInfoMenu.querySelector('.user-info-menu-content');
          const actions = userInfoMenu.querySelector('.user-info-menu-actions');
          
          if (header) header.textContent = 'Account Information';
          if (content) {
            content.innerHTML = `
              <div class="info-row">
                <label>Email:</label>
                <span id="menu-email">Loading...</span>
              </div>
              <div class="info-row">
                <label>User Name:</label>
                <input type="text" id="menu-display-name" class="menu-input" placeholder="Enter name">
              </div>
              <div class="info-row">
                <label>Account Created:</label>
                <span id="menu-created">Loading...</span>
              </div>
            `;
          }
          if (actions) actions.style.display = 'block';
        }
      }

      // Update account info section for signed out users
      function updateAccountInfoForSignedOutUser() {
        const userInfoDropdown = document.getElementById('user-info-dropdown');
        const userInfoMenu = document.getElementById('user-info-menu');
        
        if (userInfoDropdown) {
          // Replace the account info content with sign-in/sign-up options
          const header = userInfoDropdown.querySelector('.user-info-header h3');
          const content = userInfoDropdown.querySelector('.user-info-content');
          const actions = userInfoDropdown.querySelector('.user-info-actions');
          
          if (header) header.textContent = 'Sign In / Sign Up';
          if (content) {
            content.innerHTML = `
              <div class="auth-options">
                <p>Please sign in to access your account information and sync your data across devices.</p>
                <div class="auth-buttons">
                  <button type="button" id="dropdown-signin-btn" class="dropdown-signin-btn">Sign In</button>
                  <button type="button" id="dropdown-signup-btn" class="dropdown-signup-btn">Sign Up</button>
                </div>
              </div>
            `;
          }
          if (actions) actions.style.display = 'none';
        }
        
        if (userInfoMenu) {
          // Same for mobile menu
          const header = userInfoMenu.querySelector('.user-info-menu-header h3');
          const content = userInfoMenu.querySelector('.user-info-menu-content');
          const actions = userInfoMenu.querySelector('.user-info-menu-actions');
          
          if (header) header.textContent = 'Sign In / Sign Up';
          if (content) {
            content.innerHTML = `
              <div class="auth-options">
                <p>Please sign in to access your account information and sync your data across devices.</p>
                <div class="auth-buttons">
                  <button type="button" id="menu-signin-btn" class="menu-signin-btn">Sign In</button>
                  <button type="button" id="menu-signup-btn" class="menu-signup-btn">Sign Up</button>
                </div>
              </div>
            `;
          }
          if (actions) actions.style.display = 'none';
        }
        
        // Add event listeners for the new buttons
        addAuthButtonListeners();
      }
      
      // Function to close mobile menu
      function closeMobileMenu() {
        const header = document.querySelector('.header');
        const root = document.documentElement;
        const toggle = document.getElementById('nav-toggle');
        
        if (header) header.classList.remove('nav-open');
        if (root) root.classList.remove('nav-open');
        if (toggle) toggle.setAttribute('aria-expanded', 'false');
      }
      
      // Make closeMobileMenu available globally
      window.closeMobileMenu = closeMobileMenu;
      
      // Add event listeners for auth buttons in account info sections
      let authButtonListenersAdded = false;
      function addAuthButtonListeners() {
        // Only add listeners once to avoid duplicates
        if (authButtonListenersAdded) return;
        authButtonListenersAdded = true;
        
        // Use event delegation to handle dynamically created buttons
        document.addEventListener('click', (e) => {
          // Handle desktop dropdown buttons
          if (e.target && e.target.id === 'dropdown-signin-btn') {
            e.preventDefault();
            switchAuthTab('signin');
            showAuthModal();
          }
          
          if (e.target && e.target.id === 'dropdown-signup-btn') {
            e.preventDefault();
            switchAuthTab('signup');
            showAuthModal();
          }
          
          // Handle mobile menu buttons (close menu when clicked)
          if (e.target && e.target.id === 'menu-signin-btn') {
            e.preventDefault();
            closeMobileMenu(); // Close mobile menu first
            switchAuthTab('signin');
            showAuthModal();
          }
          
          if (e.target && e.target.id === 'menu-signup-btn') {
            e.preventDefault();
            closeMobileMenu(); // Close mobile menu first
            switchAuthTab('signup');
            showAuthModal();
          }
        });
      }

      // Authentication functions
      window.authFunctions = {
        async signIn(email, password) {
          try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log('Signed in:', userCredential.user);
            return userCredential;
          } catch (error) {
            console.error('Sign in error:', error);
            throw error;
          }
        },

        async signUp(email, password) {
          try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            console.log('Signed up:', userCredential.user);
            return userCredential;
          } catch (error) {
            console.error('Sign up error:', error);
            throw error;
          }
        },

        async signInWithGoogle() {
          try {
            const result = await signInWithPopup(auth, googleProvider);
            console.log('Google sign in:', result.user);
            return result;
          } catch (error) {
            console.error('Google sign in error:', error);
            throw error;
          }
        },

        async signOut() {
          try {
            await signOut(auth);
            console.log('Signed out');
          } catch (error) {
            console.error('Sign out error:', error);
            throw error;
          }
        }
      };
      }
      
        // Call the initialization function
        initializeFirebase();
        
        // Ensure authentication UI is correct by default (fallback)
        setTimeout(() => {
          const signInBtn = document.getElementById('sign-in-btn');
          const signOutBtn = document.getElementById('sign-out-btn');
          const userEmail = document.getElementById('user-email');
          const mobileUserEmail = document.getElementById('mobile-user-email');
          
        // Check if user is actually signed in by checking Firebase auth state
        if (window.firebase && window.firebase.auth && window.firebase.auth.currentUser) {
            console.log('Fallback: User is signed in, updating UI...');
            if (signInBtn) signInBtn.style.display = 'none';
            if (signOutBtn) signOutBtn.style.display = 'none';
            if (userEmail) {
              // Show person icon instead of name
              userEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
              userEmail.style.display = 'block';
            }
            if (mobileUserEmail) {
              // Show person icon in mobile nav
              mobileUserEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
              mobileUserEmail.style.display = 'block';
            }
          } else {
            console.log('Fallback: No user signed in, showing sign-in button');
            if (signInBtn) signInBtn.style.display = 'block';
            if (signOutBtn) signOutBtn.style.display = 'none';
            if (userEmail) userEmail.style.display = 'none';
            if (mobileUserEmail) {
              // Always show mobile user profile icon on mobile devices, even when not signed in
              mobileUserEmail.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
              mobileUserEmail.style.display = 'block';
            }
          }
        }, 1000);
    </script>
    
    <script src="script.js"></script>

  </div>
  </body>
  </html>
